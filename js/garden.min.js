function Vector(a,b){this.x=a;this.y=b}Vector.prototype={rotate:function(a){var b=this.x,c=this.y;this.x=Math.cos(a)*b-Math.sin(a)*c;this.y=Math.sin(a)*b+Math.cos(a)*c;return this},mult:function(a){this.x*=a;this.y*=a;return this},clone:function(){return new Vector(this.x,this.y)},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},subtract:function(a){this.x-=a.x;this.y-=a.y;return this},set:function(a,b){this.x=a;this.y=b;return this}};
function Petal(a,b,c,d,e,f){this.stretchA=a;this.stretchB=b;this.startAngle=c;this.angle=d;this.bloom=f;this.growFactor=e;this.r=1;this.isfinished=!1}
Petal.prototype={draw:function(){var a=this.bloom.garden.ctx;var b=(new Vector(0,this.r)).rotate(Garden.degrad(this.startAngle));var c=b.clone().rotate(Garden.degrad(this.angle));var d=b.clone().mult(this.stretchA);var e=c.clone().mult(this.stretchB);a.strokeStyle=this.bloom.c;a.beginPath();a.moveTo(b.x,b.y);a.bezierCurveTo(d.x,d.y,e.x,e.y,c.x,c.y);a.stroke()},render:function(){this.r<=this.bloom.r?(this.r+=this.growFactor,this.draw()):this.isfinished=!0}};
function Bloom(a,b,c,d,e){this.p=a;this.r=b;this.c=c;this.pc=d;this.petals=[];this.garden=e;this.init();this.garden.addBloom(this)}
Bloom.prototype={draw:function(){var a=!0;this.garden.ctx.save();this.garden.ctx.translate(this.p.x,this.p.y);for(var b=0;b<this.petals.length;b++){var c=this.petals[b];c.render();a*=c.isfinished}this.garden.ctx.restore();!0===a&&this.garden.removeBloom(this)},init:function(){for(var a=360/this.pc,b=Garden.randomInt(0,90),c=0;c<this.pc;c++)this.petals.push(new Petal(Garden.random(Garden.options.petalStretch.min,Garden.options.petalStretch.max),Garden.random(Garden.options.petalStretch.min,Garden.options.petalStretch.max),
b+c*a,a,Garden.random(Garden.options.growFactor.min,Garden.options.growFactor.max),this))}};function Garden(a,b){this.blooms=[];this.element=b;this.ctx=a}
Garden.prototype={render:function(){for(var a=0;a<this.blooms.length;a++)this.blooms[a].draw()},addBloom:function(a){this.blooms.push(a)},removeBloom:function(a){for(var b,c=0;c<this.blooms.length;c++)if(b=this.blooms[c],b===a)return this.blooms.splice(c,1),this},createRandomBloom:function(a,b){this.createBloom(a,b,Garden.randomInt(Garden.options.bloomRadius.min,Garden.options.bloomRadius.max),Garden.randomrgba(Garden.options.color.rmin,Garden.options.color.rmax,Garden.options.color.gmin,Garden.options.color.gmax,
Garden.options.color.bmin,Garden.options.color.bmax,Garden.options.color.opacity),Garden.randomInt(Garden.options.petalCount.min,Garden.options.petalCount.max))},createBloom:function(a,b,c,d,e){new Bloom(new Vector(a,b),c,d,e,this)},clear:function(){this.blooms=[];this.ctx.clearRect(0,0,this.element.width,this.element.height)}};Garden.options={petalCount:{min:8,max:15},petalStretch:{min:.1,max:3},growFactor:{min:.1,max:1},bloomRadius:{min:8,max:10},density:10,growSpeed:1E3/60,tanAngle:60};
Garden.random=function(a,b){return Math.random()*(b-a)+a};Garden.randomInt=function(a,b){return Math.floor(Math.random()*(b-a+1))+a};Garden.circle=2*Math.PI;Garden.degrad=function(a){return Garden.circle/360*a};Garden.raddeg=function(a){return a/Garden.circle*360};Garden.rgba=function(a,b,c,d){return"rgba("+a+","+b+","+c+","+d+")"};
Garden.randomrgba=function(a,b,c,d,e,f,l){var g=Math.round(Garden.random(a,b)),h=Math.round(Garden.random(c,d)),k=Math.round(Garden.random(e,f));return 5>=Math.abs(g-h)&&5>=Math.abs(h-k)&&5>=Math.abs(k-g)?Garden.rgba(a,b,c,d,e,f,l):Garden.rgba(g,h,k,l)};
GARDEN_COLOR_ENUM=Object.freeze({RED:{rmin:128,rmax:255,gmin:0,gmax:128,bmin:0,bmax:128,opacity:.1},GREEN:{rmin:0,rmax:128,gmin:128,gmax:255,bmin:0,bmax:128,opacity:.1},BLUE:{rmin:0,rmax:128,gmin:0,gmax:128,bmin:128,bmax:255,opacity:.15},YELLOW:{rmin:128,rmax:255,gmin:128,gmax:255,bmin:0,bmax:128,opacity:.2},CYAN:{rmin:0,rmax:128,gmin:128,gmax:255,bmin:128,bmax:255,opacity:.1},MAGENTA:{rmin:128,rmax:255,gmin:0,gmax:128,bmin:128,bmax:255,opacity:.1}});
switch((new Date).getTime()%6){case 0:console.debug("RED");Garden.options.color=GARDEN_COLOR_ENUM.RED;break;case 1:console.debug("GREEN");Garden.options.color=GARDEN_COLOR_ENUM.GREEN;break;case 2:console.debug("BLUE");Garden.options.color=GARDEN_COLOR_ENUM.BLUE;break;case 3:console.debug("YELLOW");Garden.options.color=GARDEN_COLOR_ENUM.YELLOW;break;case 4:console.debug("CYAN");Garden.options.color=GARDEN_COLOR_ENUM.CYAN;break;case 5:console.debug("MAGENTA");Garden.options.color=GARDEN_COLOR_ENUM.MAGENTA;
break;default:console.debug("BLUE"),Garden.options.color=GARDEN_COLOR_ENUM.BLUE};
